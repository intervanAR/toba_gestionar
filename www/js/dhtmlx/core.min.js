window.d5x||(d5x={}),d5x.assert=function(t,e){t||d5x.error(e)},d5x.assert_enabled=function(){return!1},d5x.assert_event=function(t,e){for(var n in t._event_check||(t._event_check={},t._event_check_size={}),e){t._event_check[n.toLowerCase()]=e[n];var i=-1;for(var r in e[n])i++;t._event_check_size[n.toLowerCase()]=i}},d5x.assert_method_info=function(t,e,n,i){for(var r=[],s=0;s<i.length;s++)r.push(i[s][0]+" : "+i[s][1]+"\n   "+i[s][2].describe()+(i[s][3]?"; optional":""));return t.name+"."+e+"\n"+n+"\n Arguments:\n - "+r.join("\n - ")},d5x.assert_method=function(t,e){for(var n in e)d5x.assert_method_process(t,n,e[n].descr,e[n].args,e[n].min||99,e[n].skip)},d5x.assert_method_process=function(t,e,n,i,r,s){var o=t[e];s||(t[e]=function(){if(arguments.length!=i.length&&arguments.length<r)d5x.log("warn","Incorrect count of parameters\n"+t[e].describe()+"\n\nExpecting "+i.length+" but have only "+arguments.length);else for(var n=0;n<i.length;n++)i[n][3]||i[n][2](arguments[n])||d5x.log("warn","Incorrect method call\n"+t[e].describe()+"\n\nActual value of "+(n+1)+" parameter: {"+typeof arguments[n]+"} "+arguments[n]);return o.apply(this,arguments)}),t[e].describe=function(){return d5x.assert_method_info(t,e,n,i)}},d5x.assert_event_call=function(t,e,n){t._event_check&&(t._event_check[e]?d5x.isNotDefined(n)?d5x.log("warn","Event without parameters :"+e):t._event_check_size[e]!=n.length&&d5x.log("warn","Incorrect event call, expected "+t._event_check_size[e]+" parameter(s), but have "+n.length+" parameter(s), for "+e+" event"):d5x.log("warn","Not expected event call :"+e))},d5x.assert_event_attach=function(t,e){t._event_check&&!t._event_check[e]&&d5x.log("warn","Unknown event name: "+e)},d5x.assert_property=function(t,e){t._settings_check||(t._settings_check={}),d5x.extend(t._settings_check,e)},d5x.assert_check=function(t,e){if("object"==typeof t)for(var n in t)d5x.assert_settings(n,t[n],e)},d5x.assert_settings=function(t,e,n){if(n=n||this._settings_check){if(!n[t])return d5x.log("warn","Unknown propery: "+t);for(var i=!1,r=0;r<n[t].length;r++){var s=n[t][r];if("string"!=typeof s&&("function"==typeof s?i=i||s(e):"object"==typeof s&&"function"==typeof s[1]&&(i=i||s[1](e))&&s[2]&&d5x.assert_check(e,s[2]),i))break}i||d5x.log("warn","Invalid configuration\n"+d5x.assert_info(t,n)+"\nActual value: {"+typeof e+"} "+e)}},d5x.assert_info=function(t,e){for(var n=e[t],i="",r=[],s=0;s<n.length;s++)"string"==typeof rule?i=n[s]:n[s].describe?r.push(n[s].describe()):n[s][1]&&n[s][1].describe&&r.push(n[s][1].describe());return"Property: "+t+", "+i+" \nExpected value: \n - "+r.join("\n - ")},d5x.assert_enabled()&&(d5x.assert_rule_color=function(t){return"string"==typeof t&&(0===t.indexOf("#")&&""===t.substr(1).replace(/[0-9A-F]/gi,""))},d5x.assert_rule_color.describe=function(){return"{String} Value must start from # and contain hexadecimal code of color"},d5x.assert_rule_template=function(t){return"function"==typeof t||"string"==typeof t},d5x.assert_rule_template.describe=function(){return"{Function},{String} Value must be a function which accepts data object and return text string, or a sting with optional template markers"},d5x.assert_rule_boolean=function(t){return"boolean"==typeof t},d5x.assert_rule_boolean.describe=function(){return"{Boolean} true or false"},d5x.assert_rule_object=function(t,e){return"object"==typeof t},d5x.assert_rule_object.describe=function(){return"{Object} Configuration object"},d5x.assert_rule_string=function(t){return"string"==typeof t},d5x.assert_rule_string.describe=function(){return"{String} Plain string"},d5x.assert_rule_htmlpt=function(t){return!!d5x.toNode(t)},d5x.assert_rule_htmlpt.describe=function(){return"{Object},{String} HTML node or ID of HTML Node"},d5x.assert_rule_notdocumented=function(t){return!1},d5x.assert_rule_notdocumented.describe=function(){return"This options wasn't documented"},d5x.assert_rule_key=function(t){var e=function(e){return t[e]};return e.describe=function(){var e=[];for(var n in t)e.push(n);return"{String} can take one of next values: "+e.join(", ")},e},d5x.assert_rule_dimension=function(t){return 1*t==t&&!isNaN(t)&&t>=0},d5x.assert_rule_dimension.describe=function(){return"{Integer} value must be a positive number"},d5x.assert_rule_number=function(t){return"number"==typeof t},d5x.assert_rule_number.describe=function(){return"{Integer} value must be a number"},d5x.assert_rule_function=function(t){return"function"==typeof t},d5x.assert_rule_function.describe=function(){return"{Function} value must be a custom function"},d5x.assert_rule_any=function(t){return!0},d5x.assert_rule_any.describe=function(){return"Any value"},d5x.assert_rule_mix=function(t,e){var n=function(n){return!(!t(n)&&!e(n))};return n.describe=function(){return t.describe()},n}),d5x.codebase="./",d5x.copy=function(t){var e=d5x.copy._function;return e.prototype=t,new e},d5x.copy._function=function(){},d5x.extend=function(t,e){for(var n in e)t[n]=e[n];return d5x.assert_enabled()&&e._assert&&(t._assert(),t._assert=null),d5x.assert(t,"Invalid nesting target"),d5x.assert(e,"Invalid nesting source"),e._init&&t._init(),t},d5x.proto_extend=function(){for(var t=arguments,e=t[0],n=[],i=t.length-1;i>0;i--)for(var r in"function"==typeof t[i]&&(t[i]=t[i].prototype),t[i])"_init"==r?n.push(t[i][r]):e[r]||(e[r]=t[i][r]);t[0]._init&&n.push(t[0]._init),e._init=function(){for(var t=0;t<n.length;t++)n[t].apply(this,arguments)},e.base=t[1];var s=function(t){this._init(t),this._parseSettings&&this._parseSettings(t,this.defaults)};return s.prototype=e,e=t=null,s},d5x.bind=function(t,e){return function(){return t.apply(e,arguments)}},d5x.require=function(t){d5x._modules[t]||(d5x.assert(d5x.ajax,"load module is required"),d5x.exec(d5x.ajax().sync().get(d5x.codebase+t).responseText),d5x._modules[t]=!0)},d5x._modules={},d5x.exec=function(t){window.execScript?window.execScript(t):window.eval(t)},d5x.methodPush=function(t,e,n){return function(){return t[e].apply(t,arguments)}},d5x.isNotDefined=function(t){return void 0===t},d5x.delay=function(t,e,n,i){setTimeout(function(){var i=t.apply(e,n);return t=e=n=null,i},i||1)},d5x.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++,this._seed},d5x.toNode=function(t){return"string"==typeof t?document.getElementById(t):t},d5x.toArray=function(t){return d5x.extend(t||[],d5x.PowerArray)},d5x.toFunctor=function(str){return"string"==typeof str?eval(str):str},d5x._events={},d5x.event=function(t,e,n,i){t=d5x.toNode(t);var r=d5x.uid();return d5x._events[r]=[t,e,n],i&&(n=d5x.bind(n,i)),t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent&&t.attachEvent("on"+e,n),r},d5x.eventRemove=function(t){if(t){d5x.assert(this._events[t],"Removing non-existing event");var e=d5x._events[t];e[0].removeEventListener?e[0].removeEventListener(e[1],e[2],!1):e[0].detachEvent&&e[0].detachEvent("on"+e[1],e[2]),delete this._events[t]}},d5x.log=function(t,e,n){window.console&&console.log&&(t=t.toLowerCase(),window.console[t]?window.console[t](e||"unknown error"):window.console.log(t+": "+e),n&&window.console.log(n))},d5x.log_full_time=function(t){d5x._start_time_log=new Date,d5x.log("Info","Timing start ["+t+"]"),window.setTimeout(function(){var e=new Date;d5x.log("Info","Timing end ["+t+"]:"+(e.valueOf()-d5x._start_time_log.valueOf())/1e3+"s")},1)},d5x.log_time=function(t){var e="_start_time_log"+t;if(d5x[e]){var n=new Date;d5x.log("Info","Timing end ["+t+"]:"+(n.valueOf()-d5x[e].valueOf())/1e3+"s"),d5x[e]=null}else d5x[e]=new Date,d5x.log("Info","Timing start ["+t+"]")},d5x.error=function(t,e){d5x.log("error",t,e)},d5x.EventSystem={_init:function(){this._events={},this._handlers={},this._map={}},block:function(){this._events._block=!0},unblock:function(){this._events._block=!1},mapEvent:function(t){d5x.extend(this._map,t)},callEvent:function(t,e){if(this._events._block)return!0;t=t.toLowerCase(),d5x.assert_event_call(this,t,e);var n=this._events[t.toLowerCase()],i=!0;if(d5x.debug&&d5x.log("info","["+this.name+"] event:"+t,e),n)for(var r=0;r<n.length;r++)!1===n[r].apply(this,e||[])&&(i=!1);return this._map[t]&&!this._map[t].callEvent(t,e)&&(i=!1),i},attachEvent:function(t,e,n){t=t.toLowerCase(),d5x.assert_event_attach(this,t),n=n||d5x.uid(),e=d5x.toFunctor(e);var i=this._events[t]||d5x.toArray();return i.push(e),this._events[t]=i,this._handlers[n]={f:e,t:t},n},detachEvent:function(t){if(this._handlers[t]){var e=this._handlers[t].t,n=this._handlers[t].f;this._events[e].remove(n),delete this._handlers[t]}}},d5x.PowerArray={removeAt:function(t,e){t>=0&&this.splice(t,e||1)},remove:function(t){this.removeAt(this.find(t))},insertAt:function(t,e){if(e||0===e){var n=this.splice(e,this.length-e);this[e]=t,this.push.apply(this,n)}else this.push(t)},find:function(t){for(i=0;i<this.length;i++)if(t==this[i])return i;return-1},each:function(t,e){for(var n=0;n<this.length;n++)t.call(e||this,this[n])},map:function(t,e){for(var n=0;n<this.length;n++)this[n]=t.call(e||this,this[n]);return this}},d5x.env={},-1!=navigator.userAgent.indexOf("Opera")?d5x._isOpera=!0:(d5x._isIE=!!document.all,d5x._isFF=!document.all,d5x._isWebKit=-1!=navigator.userAgent.indexOf("KHTML"),-1!=navigator.appVersion.indexOf("MSIE 8.0")&&"BackCompat"!=document.compatMode&&(d5x._isIE=8),-1!=navigator.appVersion.indexOf("MSIE 9.0")&&"BackCompat"!=document.compatMode&&(d5x._isIE=9)),d5x.env={},function(){d5x.env.transform=!1,d5x.env.transition=!1;for(var t={names:["transform","transition"],transform:["transform","WebkitTransform","MozTransform","oTransform","msTransform"],transition:["transition","WebkitTransition","MozTransition","oTransition"]},e=document.createElement("DIV"),n=0;n<t.names.length;n++)for(;p=t[t.names[n]].pop();)void 0!==e.style[p]&&(d5x.env[t.names[n]]=!0)}(),d5x.env.transform_prefix=function(){var t;return d5x._isOpera?t="-o-":(t="",d5x._isFF&&(t="-moz-"),d5x._isWebKit&&(t="-webkit-")),t}(),d5x.env.svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),d5x.zIndex={drag:1e4},d5x.html={create:function(t,e,n){e=e||{};var i=document.createElement(t);for(var r in e)i.setAttribute(r,e[r]);return e.style&&(i.style.cssText=e.style),e.class&&(i.className=e.class),n&&(i.innerHTML=n),i},getValue:function(t){return(t=d5x.toNode(t))?d5x.isNotDefined(t.value)?t.innerHTML:t.value:""},remove:function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)this.remove(t[e]);else t&&t.parentNode&&t.parentNode.removeChild(t)},insertBefore:function(t,e,n){t&&(e?e.parentNode.insertBefore(t,e):n.appendChild(t))},locate:function(t,e){for(var n=(t=t||event).target||t.srcElement;n;){if(n.getAttribute){var i=n.getAttribute(e);if(i)return i}n=n.parentNode}return null},offset:function(t){if(t.getBoundingClientRect){var e=t.getBoundingClientRect(),n=document.body,i=document.documentElement,r=window.pageYOffset||i.scrollTop||n.scrollTop,s=window.pageXOffset||i.scrollLeft||n.scrollLeft,o=i.clientTop||n.clientTop||0,a=i.clientLeft||n.clientLeft||0,h=e.top+r-o,l=e.left+s-a;return{y:Math.round(h),x:Math.round(l)}}for(h=0,l=0;t;)h+=parseInt(t.offsetTop,10),l+=parseInt(t.offsetLeft,10),t=t.offsetParent;return{y:h,x:l}},pos:function(t){if((t=t||event).pageX||t.pageY)return{x:t.pageX,y:t.pageY};var e=d5x._isIE&&"BackCompat"!=document.compatMode?document.documentElement:document.body;return{x:t.clientX+e.scrollLeft-e.clientLeft,y:t.clientY+e.scrollTop-e.clientTop}},preventEvent:function(t){t&&t.preventDefault&&t.preventDefault(),d5x.html.stopEvent(t)},stopEvent:function(t){return(t||event).cancelBubble=!0,!1},addCss:function(t,e){t.className+=" "+e},removeCss:function(t,e){t.className=t.className.replace(RegExp(e,"g"),"")}},function(){var t=document.getElementsByTagName("SCRIPT");d5x.assert(t.length,"Can't locate codebase"),t.length&&((t=(t[t.length-1].getAttribute("src")||"").split("/")).splice(t.length-1,1),d5x.codebase=t.slice(0,t.length).join("/")+"/")}(),d5x.ui||(d5x.ui={}),d5x.Destruction={_init:function(){d5x.destructors.push(this)},destructor:function(t){this.destructor=function(){},this._htmlmap=null,this._htmlrows=null,this._html&&document.body.appendChild(this._html),this._html=null,this._obj&&(this._obj.innerHTML="",this._obj._htmlmap=null),this._obj=this._dataobj=null,this.data=null,this._events=this._handlers={},this.canvases=[],this.render&&(this.render=function(){})}},d5x.destructors=[],d5x.event(window,"unload",function(){if(d5x.destructors){for(var t=0;t<d5x.destructors.length;t++)d5x.destructors[t].destructor(-1);d5x.destructors=[]}for(var e in d5x._events){var n=d5x._events[e];n[0].removeEventListener?n[0].removeEventListener(n[1],n[2],!1):n[0].detachEvent&&n[0].detachEvent("on"+n[1],n[2]),delete d5x._events[e]}}),d5x.ajax=function(t,e,n){if(0!==arguments.length){var i=new d5x.ajax;n&&(i.master=n),i.get(t,null,e)}return this.getXHR?this:new d5x.ajax},d5x.ajax.prototype={getXHR:function(){return d5x._isIE?new ActiveXObject("Microsoft.xmlHTTP"):new XMLHttpRequest},send:function(t,e,n){var i=this.getXHR();if("function"==typeof n&&(n=[n]),"object"==typeof e){var r=[];for(var s in e){var o=e[s];null!==o&&o!==d5x.undefined||(o=""),r.push(s+"="+encodeURIComponent(o))}e=r.join("&")}e&&!this.post&&(t=t+(-1!=t.indexOf("?")?"&":"?")+e,e=null),i.open(this.post?"POST":"GET",t,!this._sync),this.post&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var a=this;return i.onreadystatechange=function(){if(!i.readyState||4==i.readyState){if(n&&a)for(var t=0;t<n.length;t++)n[t]&&n[t].call(a.master||a,i.responseText,i.responseXML,i);a.master=null,n=a=null}},i.send(e||null),i},get:function(t,e,n){return this.post=!1,this.send(t,e,n)},post:function(t,e,n){return this.post=!0,this.send(t,e,n)},sync:function(){return this._sync=!0,this}},d5x.AtomDataLoader={_init:function(t){this.data={},t&&(this._settings.datatype=t.datatype||"json",this._after_init.push(this._load_when_ready))},_load_when_ready:function(){this._ready_for_data=!0,this._settings.url&&this.url_setter(this._settings.url),this._settings.data&&this.data_setter(this._settings.data)},url_setter:function(t){return this._ready_for_data?(this.load(t,this._settings.datatype),t):t},data_setter:function(t){return this._ready_for_data?(this.parse(t,this._settings.datatype),!0):t},load:function(t,e){if(this.callEvent("onXLS",[]),"string"==typeof e?(this.data.driver=d5x.DataDriver[e],e=arguments[2]):this.data.driver=d5x.DataDriver[this._settings.datatype||"xml"],window.dhx4)return dhx4.ajax.get(t,d5x.bind(function(t){var n=t.xmlDoc,i=n.responseText,r=n.responseXML;this._onLoad&&this._onLoad.call(this,i,r,n),e&&e.call(this,i,r,n)},this));d5x.ajax(t,[this._onLoad,e],this)},parse:function(t,e){this.callEvent("onXLS",[]),this.data.driver=d5x.DataDriver[e||"xml"],this._onLoad(t,null)},_onLoad:function(t,e,n){var i=this.data.driver,r=i.getRecords(i.toObject(t,e))[0];this.data=i?i.getDetails(r):t,this.callEvent("onXLE",[])},_check_data_feed:function(t){if(!this._settings.dataFeed||this._ignore_feed||!t)return!0;var e=this._settings.dataFeed;return"function"==typeof e?e.call(this,t.id||t,t):(e=e+(-1==e.indexOf("?")?"?":"&")+"action=get&id="+encodeURIComponent(t.id||t),this.callEvent("onXLS",[]),d5x.ajax(e,function(t,e){this._ignore_feed=!0,this.setValues(d5x.DataDriver.json.toObject(t)[0]),this._ignore_feed=!1,this.callEvent("onXLE",[])},this),!1)}},d5x.DataDriver={},d5x.DataDriver.json={toObject:function(data){return data||(data="[]"),"string"==typeof data?(eval("d5x.temp="+data),d5x.temp):data},getRecords:function(t){return t&&t.data&&(t=t.data),!t||t instanceof Array?t:[t]},getDetails:function(t){return t},getInfo:function(t){return{_size:t.total_count||0,_from:t.pos||0,_key:t.dhx_security}}},d5x.DataDriver.json_ext={toObject:function(data){if(data||(data="[]"),"string"==typeof data){var temp;eval("temp="+data),d5x.temp=[];for(var header=temp.header,i=0;i<temp.data.length;i++){for(var item={},j=0;j<header.length;j++)void 0!==temp.data[i][j]&&(item[header[j]]=temp.data[i][j]);d5x.temp.push(item)}return d5x.temp}return data},getRecords:function(t){return!t||t instanceof Array?t:[t]},getDetails:function(t){return t},getInfo:function(t){return{_size:t.total_count||0,_from:t.pos||0}}},d5x.DataDriver.html={toObject:function(t){if("string"==typeof t){var e=null;return-1==t.indexOf("<")&&(e=d5x.toNode(t)),e||((e=document.createElement("DIV")).innerHTML=t),e.getElementsByTagName(this.tag)}return t},getRecords:function(t){return t.tagName?t.childNodes:t},getDetails:function(t){return d5x.DataDriver.xml.tagToObject(t)},getInfo:function(t){return{_size:0,_from:0}},tag:"LI"},d5x.DataDriver.jsarray={toObject:function(data){return"string"==typeof data?(eval("d5x.temp="+data),d5x.temp):data},getRecords:function(t){return t},getDetails:function(t){for(var e={},n=0;n<t.length;n++)e["data"+n]=t[n];return e},getInfo:function(t){return{_size:0,_from:0}}},d5x.DataDriver.csv={toObject:function(t){return t},getRecords:function(t){return t.split(this.row)},getDetails:function(t){t=this.stringToArray(t);for(var e={},n=0;n<t.length;n++)e["data"+n]=t[n];return e},getInfo:function(t){return{_size:0,_from:0}},stringToArray:function(t){t=t.split(this.cell);for(var e=0;e<t.length;e++)t[e]=t[e].replace(/^[ \t\n\r]*(\"|)/g,"").replace(/(\"|)[ \t\n\r]*$/g,"");return t},row:"\n",cell:","},d5x.DataDriver.xml={toObject:function(t,e){return e&&(e=this.checkResponse(t,e))?e:"string"==typeof t?this.fromString(t):t},getRecords:function(t){return this.xpath(t,this.records)},records:"/*/item",getDetails:function(t){return this.tagToObject(t,{})},getInfo:function(t){return{_size:t.documentElement.getAttribute("total_count")||0,_from:t.documentElement.getAttribute("pos")||0,_key:t.documentElement.getAttribute("dhx_security")}},xpath:function(t,e){if(window.XPathResult){var n=t;-1==t.nodeName.indexOf("document")&&(t=t.ownerDocument);for(var i=[],r=t.evaluate(e,n,null,XPathResult.ANY_TYPE,null),s=r.iterateNext();s;)i.push(s),s=r.iterateNext();return i}var o=!0;try{void 0===t.selectNodes&&(o=!1)}catch(t){}if(o)return t.selectNodes(e);var a=e.split("/").pop();return t.getElementsByTagName(a)},tagToObject:function(t,e){e=e||{};for(var n=!1,i=t.childNodes,r=0;r<i.length;r++)if(1==i[r].nodeType){var s=i[r].tagName;void 0!==e[s]?(e[s]instanceof Array||(e[s]=[e[s]]),e[s].push(this.tagToObject(i[r],{}))):e[i[r].tagName]=this.tagToObject(i[r],{}),n=!0}var o=t.attributes;if(o&&o.length){for(r=0;r<o.length;r++)e[o[r].name]=o[r].value;n=!0}return n?(e.value=this.nodeValue(t),e):this.nodeValue(t)},nodeValue:function(t){return t.firstChild?t.firstChild.wholeText||t.firstChild.data:""},fromString:function(t){if(window.DOMParser&&!d5x._isIE)return(new DOMParser).parseFromString(t,"text/xml");if(window.ActiveXObject){var e=new ActiveXObject("Microsoft.xmlDOM");return e.loadXML(t),e}d5x.error("Load from xml string is not supported")},checkResponse:function(t,e){if(e&&e.firstChild&&"parsererror"!=e.firstChild.tagName)return e;var n=this.fromString(t.replace(/^[\s]+/,""));if(n)return n;d5x.error("xml can't be parsed",t)}},d5x.DataLoader={_init:function(t){t=t||"",this.name="DataStore",this.data=t.datastore||new d5x.DataStore,this._readyHandler=this.data.attachEvent("onStoreLoad",d5x.bind(this._call_onready,this))},load:function(t,e){d5x.AtomDataLoader.load.apply(this,arguments),this.data.feed||(this.data.feed=function(e,n){if(this._load_count)return this._load_count=[e,n];this._load_count=!0,this.load(t+(-1==t.indexOf("?")?"?":"&")+"posStart="+e+"&count="+n,function(){var t=this._load_count;this._load_count=!1,"object"==typeof t&&this.data.feed.apply(this,t)})})},_onLoad:function(t,e,n){this.data._parse(this.data.driver.toObject(t,e)),this.callEvent("onXLE",[]),this._readyHandler&&(this.data.detachEvent(this._readyHandler),this._readyHandler=null)},dataFeed_setter:function(t){return this.data.attachEvent("onBeforeFilter",d5x.bind(function(t,e){if(this._settings.dataFeed){var n={};if(!t&&!n)return;if("function"==typeof t){if(!e)return;t(e,n)}else n={text:e};this.clearAll();var i=this._settings.dataFeed;if("function"==typeof i)return i.call(this,e,n);var r=[];for(var s in n)r.push("dhx_filter["+s+"]="+encodeURIComponent(n[s]));return this.load(i+(i.indexOf("?")<0?"?":"&")+r.join("&"),this._settings.datatype),!1}},this)),t},_call_onready:function(){if(this._settings.ready){var t=d5x.toFunctor(this._settings.ready);t&&t.call&&t.apply(this,arguments)}}},d5x.DataStore=function(){this.name="DataStore",d5x.extend(this,d5x.EventSystem),this.setDriver("xml"),this.pull={},this.order=d5x.toArray()},d5x.DataStore.prototype={setDriver:function(t){d5x.assert(d5x.DataDriver[t],"incorrect DataDriver"),this.driver=d5x.DataDriver[t]},_parse:function(t){this.callEvent("onParse",[this.driver,t]),this._filter_order&&this.filter();var e=this.driver.getInfo(t);e._key&&(d5x.security_key=e._key);var n=this.driver.getRecords(t),i=1*(e._from||0);0===i&&this.order[0]&&(i=this.order.length);for(var r=0,s=0;s<n.length;s++){var o=this.driver.getDetails(n[s]),a=this.id(o);this.pull[a]||(this.order[r+i]=a,r++),this.pull[a]=o,this.extraParser&&this.extraParser(o),this._scheme&&(this._scheme.$init?this._scheme.$update(o):this._scheme.$update&&this._scheme.$update(o))}for(s=0;s<e._size;s++)if(!this.order[s]){o={id:a=d5x.uid(),$template:"loading"};this.pull[a]=o,this.order[s]=a}this.callEvent("onStoreLoad",[this.driver,t]),this.refresh()},id:function(t){return t.id||(t.id=d5x.uid())},changeId:function(t,e){d5x.assert(this.pull[t],"Can't change id, for non existing item: "+t),this.pull[e]=this.pull[t],this.pull[e].id=e,this.order[this.order.find(t)]=e,this._filter_order&&(this._filter_order[this._filter_order.find(t)]=e),this.callEvent("onIdChange",[t,e]),this._render_change_id&&this._render_change_id(t,e)},get:function(t){return this.item(t)},set:function(t,e){return this.update(t,e)},item:function(t){return this.pull[t]},update:function(t,e){if(this._scheme&&this._scheme.$update&&this._scheme.$update(e),!1===this.callEvent("onBeforeUpdate",[t,e]))return!1;this.pull[t]=e,this.refresh(t)},refresh:function(t){this._skip_refresh||(t?this.callEvent("onStoreUpdated",[t,this.pull[t],"update"]):this.callEvent("onStoreUpdated",[null,null,null]))},silent:function(t){this._skip_refresh=!0,t.call(this),this._skip_refresh=!1},getRange:function(t,e){if(t=t?this.indexById(t):this.startOffset||0,e?e=this.indexById(e):(e=Math.min(this.endOffset||1/0,this.dataCount()-1))<0&&(e=0),this.min&&(t=this.min),this.max&&(e=this.max),t>e){var n=e;e=t,t=n}return this.getIndexRange(t,e)},getIndexRange:function(t,e){e=Math.min(e||1/0,this.dataCount()-1);for(var n=d5x.toArray(),i=t||0;i<=e;i++)n.push(this.item(this.order[i]));return n},dataCount:function(){return this.order.length},exists:function(t){return!!this.pull[t]},move:function(t,e){if(t<0||e<0)d5x.error("DataStore::move","Incorrect indexes");else{var n=this.idByIndex(t),i=this.item(n);this.order.removeAt(t),this.order.insertAt(n,Math.min(this.order.length,e)),this.callEvent("onStoreUpdated",[n,i,"move"])}},scheme:function(t){this._scheme=t},sync:function(t,e,n){"function"!=typeof e&&(n=e,e=null),d5x.debug_bind&&(this.debug_sync_master=t,d5x.log("[sync] "+this.debug_bind_master.name+"@"+this.debug_bind_master._settings.id+" <= "+this.debug_sync_master.name+"@"+this.debug_sync_master._settings.id));var i=t;"DataStore"!=t.name&&(t=t.data);var r=d5x.bind(function(i,r,s){("update"!=s||e)&&(i=null),i||(this.order=d5x.toArray([].concat(t.order)),this._filter_order=null,this.pull=t.pull,e&&this.silent(e),this._on_sync&&this._on_sync()),d5x.debug_bind&&d5x.log("[sync:request] "+this.debug_sync_master.name+"@"+this.debug_sync_master._settings.id+" <= "+this.debug_bind_master.name+"@"+this.debug_bind_master._settings.id),n?n=!1:this.refresh(i)},this);t.attachEvent("onStoreUpdated",r),this.feed=function(t,e){i.loadNext(e,t)},r()},add:function(t,e){if(this._scheme){for(var n in t=t||{},this._scheme)t[n]=t[n]||this._scheme[n];this._scheme&&(this._scheme.$init?this._scheme.$update(t):this._scheme.$update&&this._scheme.$update(t))}var i=this.id(t),r=this.dataCount();if((d5x.isNotDefined(e)||e<0)&&(e=r),e>r&&(d5x.log("Warning","DataStore:add","Index of out of bounds"),e=Math.min(this.order.length,e)),!1===this.callEvent("onBeforeAdd",[i,t,e]))return!1;if(this.exists(i))return d5x.error("Not unique ID");if(this.pull[i]=t,this.order.insertAt(i,e),this._filter_order){var s=this._filter_order.length;!e&&this.order.length&&(s=0),this._filter_order.insertAt(i,s)}return this.callEvent("onafterAdd",[i,e]),this.callEvent("onStoreUpdated",[i,t,"add"]),i},remove:function(t){if(t instanceof Array)for(var e=0;e<t.length;e++)this.remove(t[e]);else{if(!1===this.callEvent("onBeforeDelete",[t]))return!1;if(!this.exists(t))return d5x.error("Not existing ID",t);var n=this.item(t);this.order.remove(t),this._filter_order&&this._filter_order.remove(t),delete this.pull[t],this.callEvent("onafterdelete",[t]),this.callEvent("onStoreUpdated",[t,n,"delete"])}},clearAll:function(){this.pull={},this.order=d5x.toArray(),this.feed=null,this._filter_order=null,this.callEvent("onClearAll",[]),this.refresh()},idByIndex:function(t){return(t>=this.order.length||t<0)&&d5x.log("Warning","DataStore::idByIndex Incorrect index"),this.order[t]},indexById:function(t){return this.order.find(t)},next:function(t,e){return this.order[this.indexById(t)+(e||1)]},first:function(){return this.order[0]},last:function(){return this.order[this.order.length-1]},previous:function(t,e){return this.order[this.indexById(t)-(e||1)]},sort:function(t,e,n){var i=t;"function"==typeof t?i={as:t,dir:e}:"string"==typeof t&&(i={by:t,dir:e,as:n});var r=[i.by,i.dir,i.as];if(this.callEvent("onbeforesort",r)){if(this.order.length){var s=d5x.sort.create(i),o=this.getRange(this.first(),this.last());o.sort(s),this.order=o.map(function(t){return this.id(t)},this)}this.refresh(),this.callEvent("onaftersort",r)}},filter:function(t,e){if(this.callEvent("onBeforeFilter",[t,e])&&(this._filter_order&&(this.order=this._filter_order,delete this._filter_order),this.order.length)){if(t){var n=t;e=e||"","string"==typeof t&&(t=d5x.Template.fromHTML(t),e=e.toString().toLowerCase(),n=function(e,n){return-1!=t(e).toLowerCase().indexOf(n)});for(var i=d5x.toArray(),r=0;r<this.order.length;r++){var s=this.order[r];n(this.item(s),e)&&i.push(s)}this._filter_order=this.order,this.order=i}this.refresh(),this.callEvent("onAfterFilter",[])}},each:function(t,e){for(var n=0;n<this.order.length;n++)t.call(e||this,this.item(this.order[n]))},provideApi:function(t,e){this.debug_bind_master=t,e&&this.mapEvent({onbeforesort:t,onaftersort:t,onbeforeadd:t,onafteradd:t,onbeforedelete:t,onafterdelete:t,onbeforeupdate:t});for(var n=["get","set","sort","add","remove","exists","idByIndex","indexById","item","update","refresh","dataCount","filter","next","previous","clearAll","first","last","serialize"],i=0;i<n.length;i++)t[n[i]]=d5x.methodPush(this,n[i]);d5x.assert_enabled()&&this.assert_event(t)},serialize:function(){for(var t=this.order,e=[],n=0;n<t.length;n++)e.push(this.pull[t[n]]);return e}},d5x.sort={create:function(t){return d5x.sort.dir(t.dir,d5x.sort.by(t.by,t.as))},as:{int:function(t,e){return(t*=1)>(e*=1)?1:t<e?-1:0},string_strict:function(t,e){return(t=t.toString())>(e=e.toString())?1:t<e?-1:0},string:function(t,e){return(t=t.toString().toLowerCase())>(e=e.toString().toLowerCase())?1:t<e?-1:0}},by:function(t,e){return t?("function"!=typeof e&&(e=d5x.sort.as[e||"string"]),t=d5x.Template.fromHTML(t),function(n,i){return e(t(n),t(i))}):e},dir:function(t,e){return"asc"==t?e:function(t,n){return-1*e(t,n)}}},d5x.KeyEvents={_init:function(){d5x.event(this._obj,"keypress",this._onKeyPress,this)},_onKeyPress:function(t){var e=(t=t||event).which||t.keyCode;this.callEvent(this._edit_id?"onEditKeyPress":"onKeyPress",[e,t.ctrlKey,t.shiftKey,t])}},d5x.MouseEvents={_init:function(){this.on_click&&(d5x.event(this._obj,"click",this._onClick,this),d5x.event(this._obj,"contextmenu",this._onContext,this)),this.on_dblclick&&d5x.event(this._obj,"dblclick",this._onDblClick,this),this.on_mouse_move&&(d5x.event(this._obj,"mousemove",this._onMouse,this),d5x.event(this._obj,d5x._isIE?"mouseleave":"mouseout",this._onMouse,this))},_onClick:function(t){return this._mouseEvent(t,this.on_click,"ItemClick")},_onDblClick:function(t){return this._mouseEvent(t,this.on_dblclick,"ItemDblClick")},_onContext:function(t){var e=d5x.html.locate(t,this._id);if(e&&!this.callEvent("onBeforeContextMenu",[e,t]))return d5x.html.preventEvent(t)},_onMouse:function(t){d5x._isIE&&(t=document.createEventObject(event)),this._mouse_move_timer&&window.clearTimeout(this._mouse_move_timer),this.callEvent("onMouseMoving",[t]),this._mouse_move_timer=window.setTimeout(d5x.bind(function(){"mousemove"==t.type?this._onMouseMove(t):this._onMouseOut(t)},this),500)},_onMouseMove:function(t){this._mouseEvent(t,this.on_mouse_move,"MouseMove")||this.callEvent("onMouseOut",[t||event])},_onMouseOut:function(t){this.callEvent("onMouseOut",[t||event])},_mouseEvent:function(t,e,n){for(var i=(t=t||event).target||t.srcElement,r="",s=null,o=!1;i&&i.parentNode;){if(!o&&i.getAttribute&&(s=i.getAttribute(this._id))){if(i.getAttribute("userdata")&&this.callEvent("onLocateData",[s,i,t]),!this.callEvent("on"+n,[s,t,i]))return;o=!0}if((r=i.className)&&e[r=(r=r.split(" "))[0]||r[1]])return e[r].call(this,t,s||d5x.html.locate(t,this._id),i);i=i.parentNode}return o}},d5x.Settings={_init:function(){this._settings=this.config={}},define:function(t,e){return"object"==typeof t?this._parseSeetingColl(t):this._define(t,e)},_define:function(t,e){d5x.assert_settings.call(this,t,e);var n=this[t+"_setter"];return this._settings[t]=n?n.call(this,e):e},_parseSeetingColl:function(t){if(t)for(var e in t)this._define(e,t[e])},_parseSettings:function(t,e){var n=d5x.extend({},e);"object"!=typeof t||t.tagName||d5x.extend(n,t),this._parseSeetingColl(n)},_mergeSettings:function(t,e){for(var n in e)switch(typeof t[n]){case"object":t[n]=this._mergeSettings(t[n]||{},e[n]);break;case"undefined":t[n]=e[n]}return t},_parseContainer:function(t,e,n){"object"!=typeof t||t.tagName||(t=t.container),this._obj=this.$view=d5x.toNode(t),!this._obj&&n&&(this._obj=n(t)),d5x.assert(this._obj,"Incorrect html container"),this._obj.className+=" "+e,this._obj.onselectstart=function(){return!1},this._dataobj=this._obj},_set_type:function(t){if("object"==typeof t)return this.type_setter(t);d5x.assert(this.types,"RenderStack :: Types are not defined"),d5x.assert(this.types[t],"RenderStack :: Inccorect type name",t),this.type=d5x.extend({},this.types[t]),this.customize()},customize:function(t){t&&d5x.extend(this.type,t),this.type._item_start=d5x.Template.fromHTML(this.template_item_start(this.type)),this.type._item_end=this.template_item_end(this.type),this.render()},type_setter:function(t){return this._set_type("object"==typeof t?d5x.Type.add(this,t):t),t},template_setter:function(t){return this.type_setter({template:t})},css_setter:function(t){return this._obj.className+=" "+t,t}},d5x.Template={_cache:{},empty:function(){return""},setter:function(t){return d5x.Template.fromHTML(t)},obj_setter:function(t){var e=d5x.Template.setter(t),n=this;return function(){return e.apply(n,arguments)}},fromHTML:function(t){return"function"==typeof t?t:this._cache[t]?this._cache[t]:(t='return "'+(t=(t=(t=(t=(t=(t=(t=(t=(t=(t=(t||"").toString()).replace(/[\r\n]+/g,"\\n")).replace(/\{obj\.([^}?]+)\?([^:]*):([^}]*)\}/g,'"+(obj.$1?"$2":"$3")+"')).replace(/\{common\.([^}\(]*)\}/g,'"+common.$1+"')).replace(/\{common\.([^\}\(]*)\(\)\}/g,'"+(common.$1?common.$1(obj):"")+"')).replace(/\{obj\.([^}]*)\}/g,'"+obj.$1+"')).replace(/#([a-z0-9_]+)#/gi,'"+obj.$1+"')).replace(/\{obj\}/g,'"+obj+"')).replace(/\{-obj/g,"{obj")).replace(/\{-common/g,"{common"))+'";',this._cache[t]=Function("obj","common",t))}},d5x.Type={add:function(t,e){!t.types&&t.prototype.types&&(t=t.prototype),d5x.assert_enabled()&&this.assert_event(e);var n=e.name||"default";return this._template(e),this._template(e,"edit"),this._template(e,"loading"),t.types[n]=d5x.extend(d5x.extend({},t.types[n]||this._default),e),n},_default:{css:"default",template:function(){return""},template_edit:function(){return""},template_loading:function(){return"..."},width:150,height:80,margin:5,padding:0},_template:function(t,e){var n=t[e="template"+(e?"_"+e:"")];if(n&&"string"==typeof n){if(-1!=n.indexOf("->"))switch((n=n.split("->"))[0]){case"html":n=d5x.html.getValue(n[1]).replace(/\"/g,'\\"');break;case"http":n=(new d5x.ajax).sync().get(n[1],{uid:(new Date).valueOf()}).responseText}t[e]=d5x.Template.fromHTML(n)}}},d5x.SingleRender={_init:function(){},_toHTML:function(t){return this.type._item_start(t,this.type)+this.type.template(t,this.type)+this.type._item_end},render:function(){this.callEvent&&!this.callEvent("onBeforeRender",[this.data])||(this.data&&(this._dataobj.innerHTML=this._toHTML(this.data)),this.callEvent&&this.callEvent("onAfterRender",[]))}},d5x.ui.Tooltip=function(t){this.name="Tooltip",d5x.assert_enabled()&&this._assert(),"string"==typeof t&&(t={template:t}),d5x.extend(this,d5x.Settings),d5x.extend(this,d5x.SingleRender),this._parseSettings(t,{type:"default",dy:0,dx:20}),this._dataobj=this._obj=document.createElement("DIV"),this._obj.className="dhx_tooltip",d5x.html.insertBefore(this._obj,document.body.firstChild)},d5x.ui.Tooltip.prototype={show:function(t,e){this._disabled||(this.data!=t&&(this.data=t,this.render(t)),this._obj.style.top=e.y+this._settings.dy+"px",this._obj.style.left=e.x+this._settings.dx+"px",this._obj.style.display="block")},hide:function(){this.data=null,this._obj.style.display="none"},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},types:{default:d5x.Template.fromHTML("{obj.id}")},template_item_start:d5x.Template.empty,template_item_end:d5x.Template.empty},d5x.AutoTooltip={tooltip_setter:function(t){var e=new d5x.ui.Tooltip(t);return this.attachEvent("onMouseMove",function(t,n){e.show(this.get(t),d5x.html.pos(n))}),this.attachEvent("onMouseOut",function(t,n){e.hide()}),this.attachEvent("onMouseMoving",function(t,n){e.hide()}),e}},d5x.compat=function(t,e){d5x.compat[t]&&d5x.compat[t](e)},d5x.attaches||(d5x.attaches={}),d5x.attaches.attachAbstract=function(t,e){var n=document.createElement("DIV");n.id="CustomObject_"+d5x.uid(),n.style.width="100%",n.style.height="100%",n.cmp="grid",document.body.appendChild(n),this.attachObject(n.id),e.container=n.id;var i=this.vs[this.av];i.grid=new window[t](e),i.gridId=n.id,i.gridObj=n,i.grid.setSizes=function(){this.resize?this.resize():this.render()};return this.vs[this._viewRestore()].grid},d5x.attaches.attachDataView=function(t){return this.attachAbstract("d5XDataView",t)},d5x.attaches.attachChart=function(t){return this.attachAbstract("d5XChart",t)},d5x.compat.layout=function(){};
